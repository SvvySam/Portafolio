const translations = {
  es: {
    pageTitle: "Portafolio",
    navHome: "Inicio",
    navProjects: "Proyectos",
    navExperience: "Experiencia",
    navSkills: "Habilidades",
    navContact: "Contacto",
    heroBadge: "Disponible para trabajar",
    heroTitle1: "Trayectoria &",
    heroTitle2: "Proyectos",
    heroDesc:
      "Desarrollador Web independiente enfocado en crear experiencias digitales funcionales y eficientes, combinando aprendizaje continuo con resultados sólidos.",
    heroBtnWork: "Ver Mi Trabajo",
    heroBtnCV: "Descargar CV",
    compJob1: "Proyectos Independientes",
    compJob2: "Exploración de Mercado",
    statExp: "Año de Exp.",
    statTech: "Tecnologías",
    statSatisfaction: "Dedicación",
    projectsTitle: "Portafolio Selecto",
    projectsSubtitle: "Soluciones reales para problemas complejos.",
    filterAll: "Todos",
    filterWeb: "Desarrollo Web",
    filterApp: "Aplicaciones",
    filterDesign: "UI/UX",
    project1Desc: "Plataforma de comercio headless ultrarrápida.",
    project2Desc: "SaaS de visualización de datos financieros.",
    project3Desc: "Sistema de diseño completo para empresas SaaS.",
    btnDemo: "Demo",
    btnCode: "Código",
    expTitle: "Trayectoria",
    expSubtitle: "Mi camino profesional y académico.",
    job1Title: "Desarrollador Web",
    job1Desc:
      "Experiencia acumulada y preparación técnica lista para afrontar nuevos proyectos desafiantes y complejos.",
    job2Title: "Freelance Junior",
    job2Desc:
      "Freelance novato explorando el mercado, en busca de nuevos retos y oportunidades de crecimiento profesional.",
    job3Title: "Estudiante Universitario",
    job3Comp: "Universidad",
    job3Desc:
      "Graduado de la universidad obteniendo el título de Técnico Superior.",
    testiTitle: "Recomendaciones",
    testi1Text:
      '"Increíble atención al detalle. Entregó el proyecto antes de tiempo y superó nuestras expectativas de diseño."',
    testi2Text:
      '"Un profesional verdadero. Su código es limpio, mantenible y la comunicación fue fluida todo el tiempo."',
    contactTitle: "Hablemos",
    contactText:
      "¿Tienes un proyecto en mente? Envíame un mensaje y lo haremos realidad.",
    phName: "Tu Nombre",
    phEmail: "Tu Email",
    phMessage: "Mensaje",
    btnSend: "Enviar Mensaje",
    footerRights: "Todos los derechos reservados.",
    errEmailInvalid: "Por favor, introduce un correo electrónico válido sin espacios.",
  },
  en: {
    pageTitle: "Portfolio",
    navHome: "Home",
    navProjects: "Projects",
    navExperience: "Experience",
    navSkills: "Skills",
    navContact: "Contact",
    heroBadge: "Available for work",
    heroTitle1: "Career &",
    heroTitle2: "Projects",
    heroDesc:
      "Independent Web Developer focused on creating functional and efficient digital experiences, combining continuous learning with solid results.",
    heroBtnWork: "View My Work",
    heroBtnCV: "Download CV",
    compJob1: "Independent Projects",
    compJob2: "Market Exploration",
    statExp: "Year Exp.",
    statTech: "Technologies",
    statSatisfaction: "Dedication",
    projectsTitle: "Select Portfolio",
    projectsSubtitle: "Real solutions for complex problems.",
    filterAll: "All",
    filterWeb: "Web Dev",
    filterApp: "Apps",
    filterDesign: "UI/UX",
    project1Desc: "Blazing fast headless commerce platform.",
    project2Desc: "Financial data visualization SaaS.",
    project3Desc: "Complete design system for SaaS companies.",
    btnDemo: "Live Demo",
    btnCode: "Code",
    expTitle: "Career Path",
    expSubtitle: "My professional and academic journey.",
    job1Title: "Web Developer",
    job1Desc:
      "Accumulated experience and technical preparation ready to face new challenging and complex projects.",
    job2Title: "Junior Freelance",
    job2Desc:
      "Novice freelancer exploring the market, looking for new challenges and professional growth opportunities.",
    job3Title: "University Student",
    job3Comp: "University",
    job3Desc:
      "Graduated from university obtaining the Higher Technician degree.",
    testiTitle: "Testimonials",
    testi1Text:
      '"Incredible attention to detail. Delivered the project ahead of schedule and exceeded our design expectations."',
    testi2Text:
      '"A true professional. Clean, maintainable code and smooth communication throughout the process."',
    contactTitle: "Let's Talk",
    contactText:
      "Have a project in mind? Send me a message and let's make it real.",
    phName: "Your Name",
    phEmail: "Your Email",
    phMessage: "Message",
    btnSend: "Send Message",
    footerRights: "All rights reserved.",
    errEmailInvalid: "Please enter a valid email address without spaces.",
  },
  ja: {
    pageTitle: "ポートフォリオ",
    navHome: "ホーム",
    navProjects: "プロジェクト",
    navExperience: "経験",
    navSkills: "スキル",
    navContact: "お問い合わせ",
    heroBadge: "お仕事募集中",
    heroTitle1: "経歴と",
    heroTitle2: "プロジェクト",
    heroDesc:
      "継続的な学習と確かな実績を組み合わせ、機能的で効率的なデジタル体験の創造に注力している独立系Web開発者です。",
    heroBtnWork: "実績を見る",
    heroBtnCV: "履歴書をダウンロード",
    compJob1: "個人プロジェクト",
    compJob2: "市場開拓",
    statExp: "経験年数",
    statTech: "技術スタック",
    statSatisfaction: "献身度",
    projectsTitle: "厳選ポートフォリオ",
    projectsSubtitle: "複雑な課題に対する、実用的なソリューション。",
    filterAll: "すべて",
    filterWeb: "Web開発",
    filterApp: "アプリ",
    filterDesign: "UI/UX",
    project1Desc: "超高速ヘッドレスコマースプラットフォーム。",
    project2Desc: "財務データ可視化SaaS。",
    project3Desc: "SaaS企業向けの完全なデザインシステム。",
    btnDemo: "デモ",
    btnCode: "コード",
    expTitle: "これまでの歩み",
    expSubtitle: "私の専門的および学術的な旅路。",
    job1Title: "Web開発者",
    job1Desc:
      "蓄積された経験と技術的な準備により、新しい挑戦的で複雑なプロジェクトに取り組む準備ができています。",
    job2Title: "ジュニアフリーランス",
    job2Desc:
      "市場を探索している駆け出しのフリーランサーで、新しい挑戦と専門的な成長の機会を求めています。",
    job3Title: "大学生",
    job3Comp: "大学",
    job3Desc: "大学を卒業し、高等技術者の学位を取得しました。",
    contactTitle: "お問い合わせ",
    contactText: "プロジェクトのご相談、お気軽にお問い合わせください。",
    phName: "お名前",
    phEmail: "メールアドレス",
    phMessage: "メッセージ",
    btnSend: "メッセージを送信",
    footerRights: "All rights reserved.",
    errEmailInvalid: "スペースを含まない有効なメールアドレスを入力してください。",
  },
  zh: {
    pageTitle: "作品集",
    navHome: "首页",
    navProjects: "项目",
    navExperience: "经验",
    navSkills: "技能",
    navContact: "联系",
    heroBadge: "可承接项目",
    heroTitle1: "职业轨迹与",
    heroTitle2: "项目",
    heroDesc:
      "独立的Web开发人员，专注于创建功能齐全且高效的数字体验，将持续学习与坚实成果相结合。",
    heroBtnWork: "查看作品",
    heroBtnCV: "下载简历",
    compJob1: "独立项目",
    compJob2: "市场探索",
    statExp: "年经验",
    statTech: "技术",
    statSatisfaction: "投入度",
    projectsTitle: "精选作品",
    projectsSubtitle: "复杂问题的实际解决方案。",
    filterAll: "全部",
    filterWeb: "Web开发",
    filterApp: "应用",
    filterDesign: "UI/UX",
    project1Desc: "极速无头商务平台。",
    project2Desc: "金融数据可视化SaaS。",
    project3Desc: "SaaS公司的完整设计系统。",
    btnDemo: "演示",
    btnCode: "代码",
    expTitle: "职业轨迹",
    expSubtitle: "我的职业和学术旅程。",
    job1Title: "Web开发人员",
    job1Desc: "积累了经验和技术准备，随时准备迎接新的挑战和复杂项目。",
    job2Title: "初级自由职业者",
    job2Desc: "探索市场的新手自由职业者，寻求新的挑战和职业成长机会。",
    job3Title: "大学生",
    job3Comp: "大学",
    job3Desc: "大学毕业，获得高等技术员学位。",
    testiTitle: "推荐",
    testi1Text:
      "“令人难以置信的细节关注。提前交付项目，并在设计上超出了我们的预期。”",
    testi2Text: "“真正的专业人士。代码干净、易于维护，沟通过程顺畅。”",
    contactTitle: "联系我",
    contactText: "有项目想法吗？给我发消息，让我们把它变成现实。",
    phName: "您的姓名",
    phEmail: "您的电子邮件",
    phMessage: "消息",
    btnSend: "发送消息",
    footerRights: "版权所有。",
    errEmailInvalid: "请输入不带空格的有效电子邮件地址。",
  },
  fr: {
    pageTitle: "Portfolio",
    navHome: "Accueil",
    navProjects: "Projets",
    navExperience: "Expérience",
    navSkills: "Compétences",
    navContact: "Contact",
    heroBadge: "Disponible pour travailler",
    heroTitle1: "Parcours &",
    heroTitle2: "Projets",
    heroDesc:
      "Développeur Web indépendant axé sur la création d'expériences numériques fonctionnelles et efficaces, alliant apprentissage continu et résultats solides.",
    heroBtnWork: "Voir Mon Travail",
    heroBtnCV: "Télécharger CV",
    compJob1: "Projets Indépendants",
    compJob2: "Exploration du Marché",
    statExp: "An d'Exp.",
    statTech: "Technologies",
    statSatisfaction: "Dévouement",
    projectsTitle: "Portfolio Sélectionné",
    projectsSubtitle: "Solutions réelles pour problèmes complexes.",
    filterAll: "Tous",
    filterWeb: "Dév Web",
    filterApp: "Apps",
    filterDesign: "UI/UX",
    project1Desc: "Plateforme e-commerce headless ultra-rapide.",
    project2Desc: "SaaS de visualisation de données financières.",
    project3Desc: "Système de design complet pour entreprises SaaS.",
    btnDemo: "Démo",
    btnCode: "Code",
    expTitle: "Parcours",
    expSubtitle: "Mon chemin professionnel et académique.",
    job1Title: "Développeur Web",
    job1Desc:
      "Expérience accumulée et préparation technique prête à affronter de nouveaux projets stimulants et complexes.",
    job2Title: "Freelance Junior",
    job2Desc:
      "Freelance novice explorant le marché, à la recherche de nouveaux défis et d'opportunités de croissance professionnelle.",
    job3Title: "Étudiant Universitaire",
    job3Comp: "Université",
    job3Desc:
      "Diplômé de l'université avec le titre de Technicien Supérieur.",
    testiTitle: "Témoignages",
    testi1Text:
      '"Incroyable attention aux détails. A livré le projet en avance et a dépassé nos attentes en design."',
    testi2Text:
      '"Un vrai professionnel. Code propre, maintenable et communication fluide tout au long du processus."',
    contactTitle: "Discutons",
    contactText:
      "Vous avez un projet en tête ? Envoyez-moi un message et réalisons-le.",
    phName: "Votre Nom",
    phEmail: "Votre Email",
    phMessage: "Message",
    btnSend: "Envoyer Message",
    footerRights: "Tous droits réservés.",
    errEmailInvalid: "Veuillez saisir une adresse e-mail valide sans espaces.",
  },
  ar: {
    pageTitle: "محفظة الأعمال",
    navHome: "الرئيسية",
    navProjects: "المشاريع",
    navExperience: "الخبرة",
    navSkills: "المهارات",
    navContact: "تواصل معي",
    heroBadge: "متاح للعمل",
    heroTitle1: "المسار و",
    heroTitle2: "المشاريع",
    heroDesc:
      "مطوّر ويب مستقل يركز على إنشاء تجارب رقمية وظيفية وفعالة، يجمع بين التعلم المستمر والنتائج الملموسة.",
    heroBtnWork: "شاهد أعمالي",
    heroBtnCV: "تحميل السيرة الذاتية",
    compJob1: "مشاريع مستقلة",
    compJob2: "استكشاف السوق",
    statExp: "سنة خبرة",
    statTech: "تكنولوجيا",
    statSatisfaction: "تفاني",
    projectsTitle: "مشاريع مختارة",
    projectsSubtitle: "حلول حقيقية لمشاكل معقدة.",
    filterAll: "الكل",
    filterWeb: "تطوير ويب",
    filterApp: "تطبيقات",
    filterDesign: "تصميم",
    project1Desc: "منصة تجارة إلكترونية فائقة السرعة.",
    project2Desc: "برمجيات لتصور البيانات المالية.",
    project3Desc: "نظام تصميم كامل لشركات البرمجيات.",
    btnDemo: "معاينة",
    btnCode: "الكود",
    expTitle: "المسار المهني",
    expSubtitle: "رحلتي المهنية والأكاديمية.",
    job1Title: "مطوّر ويب",
    job1Desc:
      "خبرة متراكمة واستعداد تقني لمواجهة مشاريع جديدة صعبة ومعقدة.",
    job2Title: "مستقل مبتدئ",
    job2Desc:
      "مستقل مبتدئ يستكشف السوق، ويبحث عن تحديات جديدة وفرص للنمو المهني.",
    job3Title: "طالب جامعي",
    job3Comp: "جامعة",
    job3Desc: "تخرج من الجامعة وحصل على درجة تقني عالي.",
    testiTitle: "التوصيات",
    testi1Text:
      '"اهتمام مذهل بالتفاصيل. سلم المشروع قبل الموعد المحدد وتجاوز توقعاتنا في التصميم."',
    testi2Text: '"مترف حقيقي. كود نظيف وقابل للصيانة وتواصل سلس طوال الوقت."',
    contactTitle: "لنتحدث",
    contactText: "هل لديك مشروع في ذهنك؟ أرسل لي رسالة ولنجعله حقيقة.",
    phName: "اسمك",
    phEmail: "بريدك الإلكتروني",
    phMessage: "الرسالة",
    btnSend: "إرسال الرسالة",
    footerRights: "جميع الحقوق محفوظة.",
    errEmailInvalid: "يرجى إدخال عنوان بريد إلكتروني صالح بدون مسافات.",
  },
};

let typewriterInterval;

document.addEventListener("DOMContentLoaded", () => {
  /* --- Functionality: Language Switcher --- */
  const langBtn = document.getElementById("langBtn");
  const langDropdown = document.querySelector(".lang-dropdown");
  const langOptions = document.querySelectorAll(".lang-dropdown li");
  const currentLangSpan = document.getElementById("currentLang");
  const langSelector = document.querySelector(".lang-selector");

  // Load saved lang or default
  const savedLang = localStorage.getItem("language") || "es";
  setLanguage(savedLang);

  // Toggle Dropdown
  langBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    langSelector.classList.toggle("active");
    langBtn.setAttribute(
      "aria-expanded",
      langSelector.classList.contains("active")
    );
  });

  // Close dropdown when clicking outside
  document.addEventListener("click", () => {
    langSelector.classList.remove("active");
    langBtn.setAttribute("aria-expanded", "false");
  });

  // Option Click
  langOptions.forEach((option) => {
    option.addEventListener("click", () => {
      const lang = option.getAttribute("data-lang");
      setLanguage(lang);
      localStorage.setItem("language", lang);
    });
  });

  function setLanguage(lang) {
    // Update HTML dir attribute for RTL support
    if (lang === "ar") {
      document.documentElement.setAttribute("dir", "rtl");
      document.documentElement.lang = "ar";
    } else {
      document.documentElement.removeAttribute("dir");
      document.documentElement.lang = lang;
    }

    // Update Text Content
    const t = translations[lang];
    document.querySelectorAll("[data-i18n]").forEach((el) => {
      const key = el.getAttribute("data-i18n");
      // Special case for typewriter
      if (key === "heroTitle2" && el.id === "typewriter") {
        clearInterval(typewriterInterval);
        el.innerText = "";
        let i = 0;
        const text = t[key];
        typewriterInterval = setInterval(() => {
          if (i < text.length) {
            el.innerText += text.charAt(i);
            i++;
          } else {
            clearInterval(typewriterInterval);
          }
        }, 100);
      } else if (t[key]) {
        el.textContent = t[key];
      }
    });

    // Update Placeholders
    document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
      const key = el.getAttribute("data-i18n-placeholder");
      if (t[key]) el.placeholder = t[key];
    });

    // Update Button Label
    const flags = {
      es: "ES",
      en: "EN",
      ja: "JA",
      zh: "中文",
      fr: "FR",
      ar: "AR",
    };
    currentLangSpan.textContent = flags[lang];
  }

  /* --- Mobile Menu --- */
  const menuToggle = document.querySelector(".menu-toggle");
  const nav = document.querySelector(".nav");
  const navLinks = document.querySelectorAll(".nav-link");

  if (menuToggle) {
    menuToggle.addEventListener("click", () => {
      nav.classList.toggle("active");
      menuToggle.classList.toggle("is-active");

      const bars = menuToggle.querySelectorAll(".bar");
      if (nav.classList.contains("active")) {
        bars[0].style.transform = "rotate(45deg) translate(5px, 6px)";
        bars[1].style.opacity = "0";
        bars[2].style.transform = "rotate(-45deg) translate(5px, -6px)";
      } else {
        bars.forEach((bar) => (bar.style.transform = "none"));
        bars[1].style.opacity = "1";
      }
    });
  }

  navLinks.forEach((link) => {
    link.addEventListener("click", () => {
      nav.classList.remove("active");
      if (menuToggle) {
        const bars = menuToggle.querySelectorAll(".bar");
        bars.forEach((bar) => (bar.style.transform = "none"));
        bars[1].style.opacity = "1";
        menuToggle.classList.remove("is-active");
      }
    });
  });

  /* --- Theme Toggle --- */
  const themeToggle = document.getElementById("theme-toggle");
  const html = document.documentElement;
  const icon = themeToggle.querySelector("i");

  const savedTheme = localStorage.getItem("theme") || "dark";
  html.setAttribute("data-theme", savedTheme);
  updateIcon(savedTheme);

  themeToggle.addEventListener("click", () => {
    const currentTheme = html.getAttribute("data-theme");
    const newTheme = currentTheme === "dark" ? "light" : "dark";

    html.setAttribute("data-theme", newTheme);
    localStorage.setItem("theme", newTheme);
    updateIcon(newTheme);
  });

  function updateIcon(theme) {
    if (theme === "dark") {
      icon.classList.remove("fa-sun");
      icon.classList.add("fa-moon");
    } else {
      icon.classList.remove("fa-moon");
      icon.classList.add("fa-sun");
    }
  }

  /* --- Scroll to Top --- */
  const scrollTopBtn = document.getElementById("scrollToTop");

  window.addEventListener("scroll", () => {
    if (window.scrollY > 500) {
      scrollTopBtn.classList.add("visible");
    } else {
      scrollTopBtn.classList.remove("visible");
    }
  });

  scrollTopBtn.addEventListener("click", () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
  });

  /* --- Stats Counter --- */
  const stats = document.querySelectorAll(".stat-number");
  let hasAnimatedStats = false;

  const animateStats = () => {
    stats.forEach((stat) => {
      const target = +stat.getAttribute("data-target");
      const speed = 200;
      const inc = target / speed;

      const updateCount = () => {
        const count = +stat.innerText;
        if (count < target) {
          stat.innerText = Math.ceil(count + inc);
          setTimeout(updateCount, 20);
        } else {
          stat.innerText = target;
        }
      };
      updateCount();
    });
  };

  /* --- Project Filters --- */
  const filterBtns = document.querySelectorAll(".filter-btn");
  const projectCards = document.querySelectorAll(".project-card");

  filterBtns.forEach((btn) => {
    btn.addEventListener("click", () => {
      filterBtns.forEach((b) => b.classList.remove("active"));
      btn.classList.add("active");

      const filter = btn.getAttribute("data-filter");

      projectCards.forEach((card) => {
        if (filter === "all" || card.getAttribute("data-category") === filter) {
          card.classList.remove("hidden");
          card.style.opacity = "0";
          setTimeout(() => (card.style.opacity = "1"), 50);
        } else {
          card.classList.add("hidden");
        }
      });
    });
  });

  /* --- Animations --- */
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          if (
            entry.target.classList.contains("stats-row") &&
            !hasAnimatedStats
          ) {
            animateStats();
            hasAnimatedStats = true;
          }

          entry.target.style.opacity = "1";
          entry.target.style.transform = "translateY(0)";
        }
      });
    },
    { threshold: 0.1 }
  );

  const animatedElements = document.querySelectorAll(
    ".section-title, .project-card, .timeline-item, .stats-row, .hero-content"
  );

  animatedElements.forEach((el) => {
    el.style.opacity = "0";
    el.style.transform = "translateY(30px)";
    el.style.transition = "all 0.6s ease-out";
    observer.observe(el);
  });

  /* --- Form Submission (AJAX with Formspree) --- */
  const contactForm = document.getElementById("contactForm");
  if (contactForm) {
    contactForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      
      const emailInput = contactForm.querySelector('input[name="email"]');
      const emailValue = emailInput.value.trim();
      const currentLang = localStorage.getItem("language") || "es";
      const errorMsg = translations[currentLang].errEmailInvalid;

      // Basic regex for email + no spaces check
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(emailValue) || emailValue.includes(" ")) {
        alert(errorMsg);
        emailInput.focus();
        return;
      }

      const btn = contactForm.querySelector("button");
      const originalText = btn.innerHTML;
      const formData = new FormData(contactForm);

      // Loading state
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
      btn.disabled = true;

      try {
        const response = await fetch(contactForm.action, {
          method: 'POST',
          body: formData,
          headers: {
            'Accept': 'application/json'
          }
        });

        if (response.ok) {
          btn.innerHTML = '<i class="fas fa-check"></i> Enviado';
          btn.style.background = "var(--accent)";
          btn.style.color = "#000";
          contactForm.reset();
          alert('¡Gracias! Tu mensaje ha sido enviado correctamente.');
        } else {
          throw new Error('Error al enviar');
        }
      } catch (error) {
        btn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error';
        btn.style.background = "#ff4d4d";
        alert('Hubo un problema al enviar el mensaje. Por favor, inténtalo de nuevo.');
      } finally {
        setTimeout(() => {
          btn.innerHTML = originalText;
          btn.style.background = "";
          btn.style.color = "";
          btn.disabled = false;
        }, 5000);
      }
    });
  }
});
